{"files":[{"id":"36a548db-5782-4370-bc54-9245db87f592","name":"appsscript","type":"json","source":"{\n  \"timeZone\": \"Europe/Berlin\",\n  \"dependencies\": {},\n  \"exceptionLogging\": \"STACKDRIVER\",\n  \"runtimeVersion\": \"V8\",\n  \"webapp\": {\n    \"executeAs\": \"USER_DEPLOYING\",\n    \"access\": \"ANYONE_ANONYMOUS\"\n  }\n}"},{"id":"fd8297a3-1841-4583-afef-0c5e883e5dc2","name":"Code","type":"server_js","source":"/**\n * Some important links:\n * Service accounts overview\n * - https://cloud.google.com/iam/docs/service-account-overview\n * Google Sheets API Overview\n * - https://developers.google.com/sheets/api/guides/concepts\n * Best practices for using service accounts\n * - https://cloud.google.com/iam/docs/best-practices-service-accounts\n * Manage Service Accounts\n * - https://cloud.google.com/iam/docs/best-practices-service-accounts#manage-service-accounts\n * ESP32 Datalogging to Google Sheets (using Google Service Account)\n * - https://randomnerdtutorials.com/esp32-datalogging-google-sheets\n * Line Chart\n * - https://www.chartjs.org/docs/latest/charts/line.html\n * Epoch Converter Functions\n * - https://www.epochconverter.com/programming/\n * How to allow others to access a web app made from a Google Apps Script?\n * - https://stackoverflow.com/questions/17910764/how-to-allow-others-to-access-a-web-app-made-from-a-google-apps-script\n * Arduino Google Sheet Client Library for Arduino devices\n * - https://github.com/mobizt/ESP-Google-Sheet-Client\n */\n\n/**\n * Route with load page handlers\n */\nvar Route \u003d {};\nRoute.path \u003d function (route, callback) {\n\tRoute[route] \u003d callback\n}\n\n/**\n * Google WebApp HTTP get() request handler\n *\n * Entry web page is DataLogger page, the page contains values of sensor over time.\n */\nfunction doGet(e) {\n\n\t/// Build the routes to different web pages\n\tRoute.path(\"DataLogger\", loadDataLoggerPage);\n\n\tif ((!e.parameter.page) || (!Route[e.parameter.page])) {\n\t\treturn loadPageNotFoundPage(e);\n\t}\n\n\treturn Route[e.parameter.page](e)\n}\n\n/**\n * Load DataLogger page\n */\nfunction loadDataLoggerPage(e) {\n\tLogger.log(\"Loading DataLogger page\")\n\tLogger.log(JSON.stringify(e));\n\tvar htmlOutput \u003d HtmlService.createTemplateFromFile(\u0027DataLogger\u0027);\n\treturn htmlOutput.evaluate().setSandboxMode(HtmlService.SandboxMode.IFRAME);\n}\n\n/**\n * Load PageNotFound page\n */\nfunction loadPageNotFoundPage(e) {\n\tLogger.log(\"Loading loadPageNotFound page\")\n\tLogger.log(JSON.stringify(e));\n\tvar htmlOutput \u003d HtmlService.createTemplateFromFile(\u0027PageNotFound\u0027);\n\treturn htmlOutput.evaluate().setSandboxMode(HtmlService.SandboxMode.IFRAME);\n}\n\n///\n/// COPY YOUR GOOGLE SHEET URL AND PASTE IT HERE\n///\nvar url \u003d\"https://docs.google.com/spreadsheets/<<<<YOUR GOOGLE SHEET ID HERE>>>>";\n\n/**\n * Grab whole data in \u0027Temperature\u0027 and \u0027Humidity\u0027 columns\n *\n * The google sheet contains three columns: Timestamp (epoch date in seconds), Temperature and Humidity\n * The rows are periodically filled by the ESP32 module.\n *\n * getRange(row, column, numRows, numColumns):\n *   Returns the range with the top left cell at the given coordinates with the given number of rows and columns.\n *\n *   var range \u003d sheet.getRange(1, 1, 3, 3);\n *   var values \u003d range.getValues();\n *   // Print values from a 3x3 box.\n *   for (var row in values) {\n *    for (var col in values[row]) {\n *       Logger.log(values[row][col]);\n *     }\n *   }\n */\nfunction getSensorValuesFromGoogleSheet() {\n\tvar ss \u003d SpreadsheetApp.openByUrl(url);\n\tvar ws \u003d ss.getSheetByName(\"Sheet1\");\n\tvar getLastRow \u003d ws.getLastRow();\n\n\treturn ws.getRange(2, 1, getLastRow - 1, 3).getValues();\n}\n\n/**\n * Grab whole statistics (avg/max/min) data\n *\n * The google sheet contains six columns: Temperature (avgerage/max/min) and Humidity (avgerage/max/min)\n * The third row is periodically calculated every time the ESP32 pushes data.\n */\nfunction getStatisticValuesFromGoogleSheet() {\n\tvar ss \u003d SpreadsheetApp.openByUrl(url);\n\tvar ws \u003d ss.getSheetByName(\"Sheet2\");\n\n\treturn ws.getRange(3, 1, 1, 6).getValues();\n}"},{"id":"b6d6e75c-b6d0-46e7-9deb-8373d3ca982e","name":"Utils","type":"server_js","source":"/**\n * Inclulde file in HTML code\n */\nfunction include(filename) {\n\treturn HtmlService.createHtmlOutputFromFile(filename).getContent();\n}\n\n/**\n * Get current script url\n */\nfunction getUrl() {\n\tvar url \u003d ScriptApp.getService().getUrl();\n\treturn url;\n}"},{"id":"652107f6-28f9-4896-aa9a-3d99657fea42","name":"DataLogger","type":"html","source":"\u003c!DOCTYPE html\u003e\n\u003chtml\u003e\n  \u003chead\u003e\n    \u003cmeta name\u003d\"viewport\" content\u003d\"width\u003ddevice-width, initial-scale\u003d1\"\u003e\n    \u003clink rel\u003d\"stylesheet\" href\u003d\"https://use.fontawesome.com/releases/v5.7.2/css/all.css\"\n      integrity\u003d\"sha384-fnmOCqbTlWIlj8LyTjo7mOUStjsKC4pOpQbqyi7RrhN7udi9RwhKkMHpvLbHG9Sr\" crossorigin\u003d\"anonymous\"\u003e    \n    \u003cbase target\u003d\"_top\"\u003e\n    \u003c!-- include styling file here (css) --\u003e\n    \u003c?!\u003d include(\u0027stylesheet\u0027); ?\u003e\n    \u003c!-- include javascript file here --\u003e\n    \u003c?!\u003d include(\u0027javascript\u0027); ?\u003e    \n  \u003c/head\u003e\n  \u003cbody\u003e\n    \u003ch1\u003eESP32 Datalogger\u003c/h1\u003e\n    \u003cform\u003e\n      \u003ccenter\u003e\n        \u003ctable id\u003d\"temperature-info\" style\u003d\"color:#059e8a;\"\u003e\n          \u003ctr\u003e\n            \u003ctd colspan\u003d\"2\" style\u003d\"font-size: 15px; padding-bottom: 15px;\"\u003e\n              \u003ccenter id\u003d\"date-last-measurement\"\u003e\n                ?\n              \u003c/center\u003e\n            \u003c/td\u003e\n            \u003ctd id\u003d\"date-start-measurement\" class\u003d\"left\" style\u003d\"font-size:15px; padding-bottom:15px;\"\u003e\n              ?\n            \u003c/td\u003e\n          \u003c/tr\u003e\n          \u003ctr\u003e\n            \u003ctd\u003e\n              \u003ci class\u003d\"fas fa-thermometer-half fa-1x\" aria-hidden\u003d\"true\"\u003e\u003c/i\u003e\n              \u003cspan class\u003d\"dht-labels\"\u003eTemperature\u003c/span\u003e\n            \u003c/td\u003e\n            \u003ctd\u003e\n              \u003cspan id\u003d\"temperature\"\u003e?\u003c/span\u003e\n              \u003cspan\u003e\u0026deg;C\u003c/span\u003e\n            \u003c/td\u003e\n            \u003ctd\u003e\n              \u003ctable id\u003d\"temperature-stats\"\u003e\n                \u003ctr\u003e\n                  \u003ctd style\u003d\"font-size: 15px;\"\u003eavg.\u003c/td\u003e\n                  \u003ctd class\u003d\"right\" style\u003d\"font-size: 15px;\"\u003e\n                    \u003cspan id\u003d\"temperature-avg\"\u003e?\u003c/span\u003e\n                    \u003cspan\u003e\u0026deg;c\u003c/span\u003e\n                  \u003c/td\u003e\n                \u003c/tr\u003e\n                \u003ctr\u003e\n                  \u003ctd style\u003d\"font-size: 15px;\"\u003emax\u003c/td\u003e\n                  \u003ctd class\u003d\"right\" style\u003d\"font-size: 15px;\"\u003e\n                    \u003cspan id\u003d\"temperature-max\"\u003e?\u003c/span\u003e\n                    \u003cspan\u003e\u0026deg;c\u003c/span\u003e\n                  \u003c/td\u003e\n                \u003c/tr\u003e\n                \u003ctr\u003e\n                  \u003ctd style\u003d\"font-size: 15px;\"\u003emin\u003c/td\u003e\n                  \u003ctd class\u003d\"right\" style\u003d\"font-size: 15px;\"\u003e\n                    \u003cspan id\u003d\"temperature-min\"\u003e?\u003c/span\u003e\n                    \u003cspan\u003e\u0026deg;c\u003c/span\u003e\n                  \u003c/td\u003e\n                \u003c/tr\u003e\n              \u003c/table\u003e\n            \u003c/td\u003e\n          \u003c/tr\u003e\n        \u003c/table\u003e\n        \u003cdiv style\u003d\"width: auto; height: auto;\"\u003e\n          \u003ccanvas id\u003d\"lineChartTemperature\" class\u003d\"chartjs-render-monitor\" \u003e\u003c/canvas\u003e\n        \u003c/div\u003e\n\n        \u003ch1 id\u003d\"feedback\"\u003eretrieving data ...\u003c/h1\u003e\n        \u003cspan id\u003d\"loader\"\u003e\u003c/span\u003e\n\n        \u003ctable id\u003d\"humidity-info\" style\u003d\"color:#00add6;\"\u003e\n          \u003ctr\u003e\n            \u003ctd colspan\u003d\"3\" style\u003d\"font-size: 15px; padding-bottom: 15px;\"\u003e\n            \u003c/td\u003e\n          \u003c/tr\u003e\n          \u003ctr\u003e\n            \u003ctd\u003e\n              \u003ci class\u003d\"fas fa-tint fa-1x\"\u003e\u003c/i\u003e\n              \u003cspan class\u003d\"dht-labels\"\u003eHumidity\u003c/span\u003e\n            \u003c/td\u003e\n            \u003ctd\u003e\n              \u003cspan id\u003d\"humidity\"\u003e?\u003c/span\u003e\n              \u003cspan\u003e\u0026percnt;\u003c/span\u003e\n            \u003c/td\u003e\n            \u003ctd\u003e\n              \u003ctable id\u003d\"humidity-stats\"\u003e\n                \u003ctr\u003e\n                  \u003ctd style\u003d\"font-size: 15px;\"\u003eavg.\u003c/td\u003e\n                  \u003ctd class\u003d\"right\" style\u003d\"font-size: 15px;\"\u003e\n                    \u003cspan id\u003d\"humidity-avg\"\u003e?\u003c/span\u003e\n                    \u003cspan\u003e\u0026percnt;\u003c/span\u003e\n                  \u003c/td\u003e\n                \u003c/tr\u003e\n                \u003ctr\u003e\n                  \u003ctd style\u003d\"font-size: 15px;\"\u003emax\u003c/td\u003e\n                  \u003ctd class\u003d\"right\" style\u003d\"font-size: 15px;\"\u003e\n                    \u003cspan id\u003d\"humidity-max\"\u003e?\u003c/span\u003e\n                    \u003cspan\u003e\u0026percnt;\u003c/span\u003e\n                  \u003c/td\u003e\n                \u003c/tr\u003e\n                \u003ctr\u003e\n                  \u003ctd style\u003d\"font-size: 15px;\"\u003emin\u003c/td\u003e\n                  \u003ctd class\u003d\"right\" style\u003d\"font-size: 15px;\"\u003e\n                    \u003cspan id\u003d\"humidity-min\"\u003e?\u003c/span\u003e\n                    \u003cspan\u003e\u0026percnt;\u003c/span\u003e\n                  \u003c/td\u003e\n                \u003c/tr\u003e\n              \u003c/table\u003e\n            \u003c/td\u003e\n          \u003c/tr\u003e\n        \u003c/table\u003e\n        \u003cdiv style\u003d\"width: auto; height: auto;\"\u003e\n          \u003ccanvas id\u003d\"lineChartHumidity\" class\u003d\"chartjs-render-monitor\" \u003e\u003c/canvas\u003e\n        \u003c/div\u003e\n      \u003c/center\u003e        \n      \u003cdiv id\u003d\"info\" style\u003d\"color:#808080\"\u003e\u003c/div\u003e\n    \u003c/form\u003e\n\n    \u003c!-- hidden element to create the Rest page link --\u003e\n    \u003c?var url \u003d getUrl();?\u003e\u003cinput type\u003d\"hidden\" value\u003d\"\u003c?\u003d url ?\u003e\" id\u003d\"url\" /\u003e\n\n  \u003c/body\u003e\n\u003c/html\u003e\n\n\u003c!-- external scripts shall be put at the end of HTML (helps to responsivness of the page) --\u003e\n\u003cscript src\u003d\"https://ajax.googleapis.com/ajax/libs/jquery/3.7.1/jquery.min.js\"\u003e\u003c/script\u003e\n\u003cscript src\u003d\"https://cdnjs.cloudflare.com/ajax/libs/jquery/3.7.1/jquery.min.js\" integrity\u003d\"sha512-v2CJ7UaYy4JwqLDIrZUI/4hqeoQieOmAZNXBeQyjo21dadnwR+8ZaIJVT8EE2iyI61OV8e6M8PP2/4hpQINQ/g\u003d\u003d\" crossorigin\u003d\"anonymous\" referrerpolicy\u003d\"no-referrer\"\u003e\u003c/script\u003e\n\u003cscript src\u003d\"https://cdnjs.cloudflare.com/ajax/libs/Chart.js/3.7.1/chart.js\" integrity\u003d\"sha512-Lii3WMtgA0C0qmmkdCpsG0Gjr6M0ajRyQRQSbTF6BsrVh/nhZdHpVZ76iMIPvQwz1eoXC3DmAg9K51qT5/dEVg\u003d\u003d\" crossorigin\u003d\"anonymous\" referrerpolicy\u003d\"no-referrer\"\u003e\u003c/script\u003e\n\u003cscript src\u003d\"https://cdnjs.cloudflare.com/ajax/libs/chartjs-plugin-datalabels/2.2.0/chartjs-plugin-datalabels.js\" integrity\u003d\"sha512-IOZHspo7CAW8RK/m/1Zm2V0yPh3gJivW2GRGL0BoejvtmxxyDEznc4q4dhWlUvxl5vWcNpJcg9YELGKvZ1u5jw\u003d\u003d\" crossorigin\u003d\"anonymous\" referrerpolicy\u003d\"no-referrer\"\u003e\u003c/script\u003e\n\n\u003c!-- these previous versions work too\n\u003cscript src\u003d\"https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js\"\u003e\u003c/script\u003e\n\u003cscript src\u003d\"https://cdnjs.cloudflare.com/ajax/libs/jquery/3.5.1/jquery.min.js\" integrity\u003d\"sha512-bLT0Qm9VnAYZDflyKcBaQ2gg0hSYNQrJ8RilYldYQ1FxQYoCLtUjuuRuZo+fjqhx/qtq/1itJ0C2ejDxltZVFg\u003d\u003d\" crossorigin\u003d\"anonymous\"\u003e\u003c/script\u003e\n\u003cscript src\u003d\"https://cdnjs.cloudflare.com/ajax/libs/Chart.js/3.5.1/chart.js\" integrity\u003d\"sha512-b3xr4frvDIeyC3gqR1/iOi6T+m3pLlQyXNuvn5FiRrrKiMUJK3du2QqZbCywH6JxS5EOfW0DY0M6WwdXFbCBLQ\u003d\u003d\" crossorigin\u003d\"anonymous\" referrerpolicy\u003d\"no-referrer\"\u003e\u003c/script\u003e\n\u003cscript src\u003d\"https://cdnjs.cloudflare.com/ajax/libs/chartjs-plugin-datalabels/2.2.0/chartjs-plugin-datalabels.js\" integrity\u003d\"sha512-IOZHspo7CAW8RK/m/1Zm2V0yPh3gJivW2GRGL0BoejvtmxxyDEznc4q4dhWlUvxl5vWcNpJcg9YELGKvZ1u5jw\u003d\u003d\" crossorigin\u003d\"anonymous\" referrerpolicy\u003d\"no-referrer\"\u003e\u003c/script\u003e\n--\u003e\n\n\u003cscript\u003e\n  /* TODO: why ???\n  setInterval(function() {\n    // ok but it opens another tab\n    var url \u003d document.getElementById(\"url\").value + \"?page\u003dDataLogger\";\n    console.log(url);\n    window.open(url, \"_top\");\n  }, 10_000); // in ms\n  */\n\n  $( document ).ready(function() {\n    /// execute script when the page is loaded\n    getStatistics();\n    getSensorValues();\n  });\n\n  /**\n   * Get request for statistics\n   */ \n  function getStatistics() {\n    /**\n     * Request server to get sensor values\n     * Handlers onSucces/onFailure provided\n     */\n    google.script.run\n      .withSuccessHandler(onSuccessStatistics)\n      .withFailureHandler(onFailure)\n      .getStatisticValuesFromGoogleSheet();\n  }\n\n  /**  \n   * Get request for temperatures and humidities\n   */ \n  function getSensorValues() {\n\n    /**\n     * Request server to get sensor values\n     * Handlers onSucces/onFailure provided\n     */\n    google.script.run\n      .withSuccessHandler(onSuccess)\n      .withFailureHandler(onFailure)\n      .getSensorValuesFromGoogleSheet();\n  };\n\n\u003c/script\u003e\n"},{"id":"bb9cd127-6c74-40cd-baa8-8148aa888f19","name":"PageNotFound","type":"html","source":"\u003c!DOCTYPE html\u003e\n\u003chtml\u003e\n\n\u003chead\u003e\n\t\u003cmeta name\u003d\"viewport\" content\u003d\"width\u003d1020\"\u003e\n\t\u003cbase target\u003d\"_top\"\u003e\n\t\u003c!-- include styling file here (css) --\u003e\n\t\u003c?!\u003d include(\u0027stylesheet\u0027); ?\u003e\n\u003c/head\u003e\n\n\u003cbody\u003e\n\t\u003cform\u003e\n\t\t\u003ch1\u003ePage not found!\u003c/h1\u003e\n\t\u003c/form\u003e\n\u003c/body\u003e\n\n\u003c/html\u003e\n"},{"id":"b9484a7e-83f4-4d4d-888e-b3730af8475e","name":"stylesheet","type":"html","source":"\u003cstyle\u003e\n\thtml {\n\t\tfont-family: Arial;\n\t\tdisplay: inline-block;\n\t\ttext-align: center;\n\t}\n\n\th2 {\n\t\tfont-size: 3.0rem;\n\t}\n\n\tp,\n\ttd {\n\t\tfont-size: 3.0rem;\n\t}\n\n\t.units {\n\t\tfont-size: 1.2rem;\n\t}\n\n\t.dht-labels {\n\t\tfont-size: 1.5rem;\n\t\tvertical-align: middle;\n\t\tpadding-bottom: 15px;\n\t}\n\n\t.right {\n\t\ttext-align: right;\n\t}\n\n\t.left {\n\t\ttext-align: left;\n\t}\n\n\t.temperature {\n\t\tcolor: \u0027#059e8a\u0027\n\t}\n\n\ttable {\n\t\tdisplay: none;\n\t}\n\n\ttable,\n\tth,\n\ttd {\n\t\tpadding-right: 15px;\n\t\tborder: 0px solid black;\n\t}\n\n\ttd {\n\t\tpadding-bottom: 0px\n\t}\n\n\tbody {\n\t\tfont-family: Arial, sans-serif;\n\t\tmargin: 20px;\n\t\tpadding: 0;\n\t\tbackground-color: #f4f4f4;\n\t}\n\n\th1 {\n\t\ttext-align: center;\n\t\tcolor: #808080\n\t}\n\n\tform {\n\t\tmax-width: 700px;\n\t\tmax-height: auto;\n\t\tmargin: auto;\n\t\tpadding: 20px;\n\t\tbackground: #fff;\n\t\tborder-radius: 8px;\n\t\tbox-shadow: 0 0 10px rgba(0, 0, 0, 0.1);\n\t}\n\n\tlabel {\n\t\tdisplay: block;\n\t\tmargin: 10px 0 5px;\n\t}\n\n\tinput[type\u003dsubmit],\n\tselect,\n\tbutton {\n\t\twidth: 100%;\n\t\tpadding: 10px;\n\t\tmargin: 5px 0px 20px;\n\t\tborder: 1px solid #ccc;\n\t\tborder-radius: 4px;\n\t}\n\n\tinput[type\u003dnumber] {\n\t\twidth: 95%;\n\t\tpadding: 10px;\n\t\tmargin: 5px 0 20px;\n\t\tborder: 1px solid #ccc;\n\t\tborder-radius: 4px;\n\t}\n\n\tbutton {\n\t\tbackground-color: #007BFF;\n\t\tcolor: #fff;\n\t\tborder: none;\n\t\tcursor: pointer;\n\t}\n\n\tbutton:hover {\n\t\tbackground-color: #0056b3;\n\t}\n\n\t#result,\n\t#output {\n\t\ttext-align: center;\n\t\tfont-size: 1.2em;\n\t\tmargin-top: 20px;\n\t}\n\n\t#loader {\n\t\tborder: 16px solid #f3f3f3;\n\t\tborder-radius: 50%;\n\t\tborder-top: 16px solid #3498db;\n\t\twidth: 120px;\n\t\theight: 120px;\n\t\t-webkit-animation: spin 2s linear infinite;\n\t\t/* Safari */\n\t\tanimation: spin 2s linear infinite;\n\t\tdisplay: flex;\n\t\talign-items: center;\n\t}\n\n\t/* Safari */\n\t@-webkit-keyframes spin {\n\t\t0% {\n\t\t\t-webkit-transform: rotate(0deg);\n\t\t}\n\n\t\t100% {\n\t\t\t-webkit-transform: rotate(360deg);\n\t\t}\n\t}\n\n\t@keyframes spin {\n\t\t0% {\n\t\t\ttransform: rotate(0deg);\n\t\t}\n\n\t\t100% {\n\t\t\ttransform: rotate(360deg);\n\t\t}\n\t}\n\u003c/style\u003e"},{"id":"fb6d8274-5efe-480e-adc1-480e5b447222","name":"javascript","type":"html","source":"\u003cscript\u003e\n\t/**\n\t * On success handler\n\t * Creates a line chart in case server executes\n\t * getSensorValues() successfully\n\t */\n\tfunction onSuccess(ar) {\n\t\t// just for debug purposes\n\t\t//console.log(ar);\n\n\t\tvar lineChartTemperatureValues \u003d [];\n\t\tvar lineChartHumidityValues \u003d [];\n\t\tvar lineChartLabels \u003d [];\n\t\tvar chartColors \u003d [\u0027#059e8a\u0027, \u0027#00add6\u0027];\n\n\t\tlet shouldSkip \u003d false;\n\t\tar.forEach(function (item, index) {\n\t\t\tif (shouldSkip) {\n\t\t\t\treturn;\n\t\t\t}\n\t\t\tif ((item[0] \u003d\u003d \"\") || (item[1] \u003d\u003d \"\")) {\n\t\t\t\tshouldSkip \u003d true;\n\t\t\t\treturn;\n\t\t\t}\n\t\t\tvar myDate \u003d formattedDateTime(new Date(item[0] * 1000));\n\t\t\tlineChartLabels.push(myDate); // or lineChartLabels.push(myDate.toGMTString());\n\t\t\tlineChartTemperatureValues.push(item[1]);\n\t\t\tlineChartHumidityValues.push(item[2]);\n\t\t});\n\n\t\t// just for debug purposes\n\t\t//console.log(\"lineChartTemperatureValues\u003d \" + lineChartTemperatureValues)\n\n\t\t// the line chart data\n\t\tvar lineChartTemperatureData \u003d {\n\t\t\tlabels: lineChartLabels,\n\t\t\tdatasets: [{\n\t\t\t\tlabel: \u0027Temperature\u0027,\n\t\t\t\tdata: lineChartTemperatureValues,\n\t\t\t\tfill: false,\n\t\t\t\tborderColor: chartColors[0],\n\t\t\t\ttension: 0.1,\n\t\t\t\tshowLine: false,\n\t\t\t}],\n\t\t};\n\n\t\tvar chartOptions \u003d {\n\t\t\tplugins: {\n\t\t\t\tlegend: {\n\t\t\t\t\tdisplay: false\n\t\t\t\t}\n\t\t\t},\n\t\t\tscales: {\n\t\t\t\tx: {\n\t\t\t\t\tticks: {\n\t\t\t\t\t\tdisplay: true\n\t\t\t\t\t},\n\t\t\t\t\tdisplay: false\n\t\t\t\t},\n\t\t\t\ty: {\n\t\t\t\t\tbeginAtZero: true,\n\t\t\t\t\tdisplay: true,\n\t\t\t\t}\n\t\t\t}\n\t\t};\n\n\t\t// grab the line chart context\n\t\tvar ctx \u003d document.getElementById(\"lineChartTemperature\").getContext(\"2d\");\n\n\t\t// render/show/create the line chart to be shown now\n\t\tvar lineChartTemperature \u003d new Chart(ctx, {\n\t\t\ttype: \u0027line\u0027,\n\t\t\tdata: lineChartTemperatureData,\n\t\t\toptions: chartOptions,\n\t\t});\n\n\t\t// the line chart data\n\t\tvar lineChartHumidityData \u003d {\n\t\t\tlabels: lineChartLabels,\n\t\t\tdatasets: [{\n\t\t\t\tlabel: \u0027Humidity\u0027,\n\t\t\t\tdata: lineChartHumidityValues,\n\t\t\t\tfill: false,\n\t\t\t\tborderColor: chartColors[1],\n\t\t\t\ttension: 0.1,\n\t\t\t\tshowLine: false,\n\t\t\t}],\n\t\t};\n\n\t\t// grab the line chart context\n\t\tctx \u003d document.getElementById(\"lineChartHumidity\").getContext(\"2d\");\n\n\t\t// render/show/create the line chart to be shown now\n\t\tvar lineChartHumidity \u003d new Chart(ctx, {\n\t\t\ttype: \u0027line\u0027,\n\t\t\tdata: lineChartHumidityData,\n\t\t\toptions: chartOptions,\n\t\t});\n\n\t\tvar nrOfSamples \u003d lineChartLabels.length;\n\t\tdocument.getElementById(\"info\").innerText \u003d \"Total of \" + nrOfSamples + \" measurements during the period \" + lineChartLabels[0] + \" - \" + lineChartLabels[nrOfSamples - 1];\n\n\t\tdocument.getElementById(\"temperature\").innerText \u003d lineChartTemperatureValues[lineChartTemperatureValues.length - 1];\n\t\tdocument.getElementById(\"humidity\").innerText \u003d lineChartHumidityValues[lineChartHumidityValues.length - 1];\n\n\t\tdocument.getElementById(\"date-start-measurement\").innerText \u003d \"since \" + formattedDate(new Date(lineChartLabels[0]));\n\t\tdocument.getElementById(\"date-last-measurement\").innerText \u003d lineChartLabels[lineChartLabels.length - 1]\n\n\n\t\t// clear user feedback\n\t\tdocument.getElementById(\"feedback\").innerText \u003d \"\";\n\t\tdocument.getElementById(\"loader\").style.display \u003d \"none\";\n\t\tdocument.getElementById(\"temperature-info\").style.display \u003d \"block\";\n\t\tdocument.getElementById(\"temperature-stats\").style.display \u003d \"block\";\n\t\tdocument.getElementById(\"humidity-info\").style.display \u003d \"block\";\n\t\tdocument.getElementById(\"humidity-stats\").style.display \u003d \"block\";\n\n\t};\n\n\t/**\n\t * Formatted date \u0026 time (dd/mm/yyyy, hh:mm)\n\t */\n\tfunction formattedDateTime(localDate) {\n\t\tconst yyyy \u003d localDate.getFullYear();\n\t\tlet mm \u003d localDate.getMonth() + 1; // Months start at 0!\n\t\tlet dd \u003d localDate.getDate();\n\t\tif (dd \u003c 10) dd \u003d \u00270\u0027 + dd;\n\t\tif (mm \u003c 10) mm \u003d \u00270\u0027 + mm;\n\t\tconst hours \u003d localDate.getHours();\n\t\tconst minutes \u003d localDate.getMinutes();\n\n\t\treturn dd + \u0027/\u0027 + mm + \u0027/\u0027 + yyyy + \u0027, \u0027 + hours + \u0027:\u0027 + minutes;\n\t}\n\n\t/**\n\t * Formatted date (dd/mm/yyyy)\n\t */\n\tfunction formattedDate(localDate) {\n\t\tconst yyyy \u003d localDate.getFullYear();\n\t\tlet mm \u003d localDate.getMonth() + 1; // Months start at 0!\n\t\tlet dd \u003d localDate.getDate();\n\t\tif (dd \u003c 10) dd \u003d \u00270\u0027 + dd;\n\t\tif (mm \u003c 10) mm \u003d \u00270\u0027 + mm;\n\n\t\treturn dd + \u0027/\u0027 + mm + \u0027/\u0027 + yyyy;\n\t}\n\n\t/**\n\t * Execute on server failure\n\t */\n\tfunction onFailure() {\n\t\tdocument.getElementById(\u0027feedback\u0027).innerText \u003d \"Server not responding, please try later again.\";\n\t\tdocument.getElementById(\"loader\").style.display \u003d \"none\";\n\t\tlocalStorage.setItem(\"visited\", \"false\");\n\t}\n\n\t/**\n\t * On success handler\n\t * Show statistic values in case server executes\n\t * getStatistics() successfully\n\t */\n\tfunction onSuccessStatistics(ar) {\n\t\t// just for debug purposes\n\t\t//console.log(ar);\n\n\t\tlet shouldSkip \u003d false;\n\t\tar.forEach(function (item, index) {\n\t\t\tif (shouldSkip) {\n\t\t\t\treturn;\n\t\t\t}\n\t\t\tif ((item[0] \u003d\u003d \"\") || (item[1] \u003d\u003d \"\") || (item[2] \u003d\u003d \"\") ||\n\t\t\t\t(item[3] \u003d\u003d \"\") || (item[4] \u003d\u003d \"\") || (item[5] \u003d\u003d \"\")) {\n\t\t\t\tshouldSkip \u003d true;\n\t\t\t\treturn;\n\t\t\t}\n\t\t\tdocument.getElementById(\"temperature-avg\").innerText \u003d parseFloat(item[0]).toFixed(1);\n\t\t\tdocument.getElementById(\"temperature-max\").innerText \u003d parseFloat(item[1]).toFixed(1);\n\t\t\tdocument.getElementById(\"temperature-min\").innerText \u003d parseFloat(item[2]).toFixed(1);\n\t\t\tdocument.getElementById(\"humidity-avg\").innerText \u003d parseFloat(item[3]).toFixed(1);\n\t\t\tdocument.getElementById(\"humidity-max\").innerText \u003d parseFloat(item[4]).toFixed(1);\n\t\t\tdocument.getElementById(\"humidity-min\").innerText \u003d parseFloat(item[5]).toFixed(1);\n\t\t});\n\t}\n\n\u003c/script\u003e"}]}